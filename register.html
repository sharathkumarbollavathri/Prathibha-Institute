<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            background: #172954;
        }

        .register-container {
            max-width: 500px;
            margin: 50px auto;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(217, 18, 18, 0.1);
        }

        .card {
            max-width: 500px;
            border-radius: 12px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            background-color: #007bff;
            color: white;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        .btn-success {
            display: block;
            margin: auto;
            width: 50%;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .form-label {
            font-size: 16px;
            font-weight: bold;
        }

        .form-check-label {
            font-size: 16px;
        }

        .error-message {
            color: red;
            font-size: 14px;
            margin-top: 5px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>

    <div class="register-container">
        <div class="card">
            <div class="card-body">
                <div class="card-header mb-3">
                    Registration Form
                </div>
                <!-- Role Selection -->
                <div class="mb-3">
                    <label class="form-label">Register As</label><br>
                    <input type="radio" name="role" value="Student" id="studentRadio" onclick="toggleForm()" required>
                    <label for="studentRadio">Student</label>
                    <input type="radio" name="role" value="Faculty" id="facultyRadio" onclick="toggleForm()" required>
                    <label for="facultyRadio">Faculty</label>
                    <small class="error-message" id="roleError"></small>
                </div>
                <form id="registrationForm">
                    <!-- Common Fields -->
                    <div class="mb-3">
                        <label class="form-label">Upload Profile Picture</label>
                        <input type="file" class="form-control" id="profilePicture" accept="image/*">
                        <small class="error-message" id="profilePictureError"></small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">First Name</label>
                        <input type="text" class="form-control" id="firstName" required>
                        <small class="error-message" id="firstNameError"></small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Last Name</label>
                        <input type="text" class="form-control" id="lastName" required>
                        <small class="error-message" id="lastNameError"></small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Date of Birth</label>
                        <input type="date" class="form-control" id="dob" required>
                        <small class="error-message" id="dobError"></small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">E-mail</label>
                        <input type="email" class="form-control" id="email" required>
                        <small class="error-message" id="emailError"></small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Mobile No</label>
                        <input type="tel" class="form-control" id="mobile" required>
                        <small class="error-message" id="mobileError"></small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Address</label>
                        <textarea class="form-control" id="address" rows="2" required></textarea>
                        <small class="error-message" id="addressError"></small>
                    </div>


                    <!-- Student-Specific Fields -->
                    <div id="studentFields">


                        <div class="mb-3">
                            <label class="form-label">Guardian Name</label>
                            <input type="text" class="form-control" id="guardianName" required>
                            <small class="error-message" id="guardianNameError"></small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Guardian Mobile No</label>
                            <input type="tel" class="form-control" id="guardianMobile" required>
                            <small class="error-message" id="guardianMobileError"></small>
                        </div>
                    </div>

                    <!-- Faculty-Specific Fields -->
                    <div id="facultyFields" class="hidden">
                        <div class="mb-3">
                            <label class="form-label">Department</label>
                            <input type="text" class="form-control" id="department" required>
                            <small class="error-message" id="departmentError"></small>
                        </div>

                        <!-- <div class="mb-3">
                            <label class="form-label">Employee ID</label>
                            <input type="text" class="form-control" id="employeeId" required>
                            <small class="error-message" id="employeeIdError"></small>
                        </div> -->
                    </div>


                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" required>
                        <small class="error-message" id="passwordError"></small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Confirm Password</label>
                        <input type="password" class="form-control" id="confirmPassword" required>
                        <small class="error-message" id="confirmPasswordError"></small>
                    </div>
                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="gridCheck">
                            <label class="form-check-label" for="gridCheck">
                                Check me out
                            </label>
                        </div>
                        <small class="error-message" id="gridCheckError"></small>
                    </div>
                    <button type="button" class="btn btn-success" onclick="submitForm()">Register</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        function showError(inputId, message) {
            document.getElementById(inputId + 'Error').innerText = message;
        }

        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(el => el.innerText = '');
        }
        function toggleForm() {
            const isStudent = document.getElementById("studentRadio").checked;
            document.getElementById("studentFields").style.display = isStudent ? "block" : "none";
            document.getElementById("facultyFields").style.display = isStudent ? "none" : "block";
        }

        function submitForm() {
            clearErrors();

            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const dob = document.getElementById('dob').value.trim();
            const email = document.getElementById('email').value.trim();
            const mobile = document.getElementById('mobile').value.trim();
            const address = document.getElementById('address').value.trim();
            const guardianName = document.getElementById('guardianName').value.trim();
            const guardianMobile = document.getElementById('guardianMobile').value.trim();
            const password = document.getElementById('password').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();
            const checkbox = document.getElementById('gridCheck');
            //DOB validation
            const today = new Date();
            const dobDate = new Date(dob);
            if (dobDate >= today) {
                showError('dob', 'Date of Birth cannot be in the future.');
                valid = false;
            }

            // Get selected role
            const selectedRole = document.querySelector('input[name="role"]:checked');
            if (!selectedRole) {
                showError('role', 'Please select Student or Faculty.');
                valid = false;
            }
            const role = selectedRole.value;

            let valid = true;
            // Validation checks
            if (!/^[A-Za-z]+$/.test(firstName)) {
                showError('firstName', 'First name should contain only letters.');
                valid = false;
            }
            if (!/^[A-Za-z]+$/.test(lastName)) {
                showError('lastName', 'Last name should contain only letters.');
                valid = false;
            }
            if (!/^\d{10}$/.test(mobile)) {
                showError('mobile', 'Mobile number should be 10 digits.');
                valid = false;
            }
            if (!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email)) {
                showError('email', 'Invalid email format.');
                valid = false;
            }
            if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,}/.test(password)) {
                showError('password', 'Password must have at least 6 characters, one uppercase, one lowercase, one digit, and one special character.');
                valid = false;
            }
            if (password !== confirmPassword) {
                showError('confirmPassword', 'Passwords do not match.');
                valid = false;
            }
            if (!checkbox.checked) {
                showError('gridCheck', 'You must agree to the terms.');
                valid = false;
            }
            if (role === "Faculty" && document.getElementById('department').value.trim() === '') {
                showError('department', 'Department is required for faculty.');
                valid = false;
            }
            //PROFILE PIC validation
            const profilePic = document.getElementById('profilePicture').files[0];
            if (profilePic) {
                const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
                if (!allowedTypes.includes(profilePic.type)) {
                    showError('profilePicture', 'Only JPG, PNG, and GIF files are allowed.');
                    valid = false;
                }
                if (profilePic.size > 2 * 1024 * 1024) { // 2MB limit
                    showError('profilePicture', 'File size must be less than 2MB.');
                    valid = false;
                }
            }


            if (!valid) return;

            const formData = new FormData();
            formData.append("firstName", firstName);
            formData.append("lastName", lastName);
            formData.append("dob", dob);
            formData.append("email", email);
            formData.append("mobile", mobile);
            formData.append("address", address);
            formData.append("guardianName", guardianName);
            formData.append("guardianMobile", guardianMobile);
            formData.append("password", password);
            formData.append("role", role);

            if (role === "Student") {
                // formData.append("dob", document.getElementById('dob').value);
                formData.append("guardianName", document.getElementById('guardianName').value);
                formData.append("guardianMobile", document.getElementById('guardianMobile').value);
            } else {
                // formData.append("dob", document.getElementById('dob').value);
                formData.append("department", document.getElementById('department').value);

            }

            //Uses code.gs file link
            fetch('https://script.google.com/macros/s/AKfycbyzh8FVuVBYoEaIJfMU4fHISKcaNL5Chrsgkq1lH_dr9I0n8hIgn6yGDknKu707EjZN/exec', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === "success") {
                        alert('üéâ Registration Successful!');
                        document.getElementById("registrationForm").reset(); // Reset form after submission
                    } else {
                        alert('‚ùå Error: ' + data.message);
                    }
                })
                .catch(error => alert('‚ö†Ô∏è Error occurred while saving data.'));
        }
    </script>

</body>

</html>